<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nearest Hospital Finder</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <script defer src="map.js"></script>
    <link rel="stylesheet" href="map.css" />
  </head>
  <body>
    <h2>Find the Nearest PHC</h2>
    <div id="search-container">
      <input type="text" id="locationInput" placeholder="Enter your location" />
      <button onclick="searchLocation()">Search</button>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
      let map = L.map("map").setView([9.082, 8.6753], 6); // Default view: Nigeria

      // Add OpenStreetMap tiles
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      // Get User's Location
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition((position) => {
          let userLat = position.coords.latitude;
          let userLng = position.coords.longitude;
          let userMarker = L.marker([userLat, userLng])
            .addTo(map)
            .bindPopup("You are here")
            .openPopup();
          map.setView([userLat, userLng], 10);
        });
      } else {
        alert("Geolocation is not supported by your browser");
      }

      // Search Function
      function searchLocation() {
        let location = document.getElementById("locationInput").value;
        if (!location) return alert("Please enter a location!");

        let url = `https://nominatim.openstreetmap.org/search?format=json&q=${location}`;

        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            if (data.length === 0) {
              alert("Location not found!");
              return;
            }
            let lat = data[0].lat;
            let lon = data[0].lon;

            L.marker([lat, lon])
              .addTo(map)
              .bindPopup(`Searched Location: ${location}`)
              .openPopup();

            map.setView([lat, lon], 12);
          })
          .catch((error) => console.error("Error fetching location:", error));
      }
    </script>
  </body>
</html>
